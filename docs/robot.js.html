<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: robot.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: robot.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>let _ROBOT_RESPONSE_ = "response";

let _ROBOT_RESPONSE_ID_ = "id";
let _ROBOT_RESPONSE_DESCRIPTION_ = "description";
let _ROBOT_RESPONSE_STATEMENTS_ = "statements";
let _ROBOT_RESPONSE_OPTIONS_ = "options";

let _ROBOT_STATEMENT_TYPE_ = "type";
let _ROBOT_STATEMENT_DATA_ = "data";

let _ROBOT_STATEMENT_TYPE__TEXT_ = "text";
let _ROBOT_STATEMENT_TYPE__QUESTION_ = "question";
let _ROBOT_STATEMENT_TYPE__ANSWER_ = "answer";
let _ROBOT_STATEMENT_TYPE__OPTION_ = "option";

let _STATEMENT_TYPES_ = [_ROBOT_STATEMENT_TYPE__TEXT_, _ROBOT_STATEMENT_TYPE__QUESTION_, _ROBOT_STATEMENT_TYPE__ANSWER_, _ROBOT_STATEMENT_TYPE__OPTION_];

let _ROBOT_DIALOG_;
let _ROBOT_UID_;
let _ROBOT_ROOM_ID_ = "robot_help"


function chatbot_init()
{
    generate_responses();
    setup_robot();
    setup_robot_room();
}

function generate_responses()
{
    add_response_to_chatbot("d001", "intro_001", "Welcome",
        [
            create_response_statement_object(_ROBOT_STATEMENT_TYPE__TEXT_, "Welcome to my chat app"),
            create_response_statement_object(_ROBOT_STATEMENT_TYPE__TEXT_, "I'm a robot, you can click on any 'Option' chat bubbles. With that said ..."),
            create_response_statement_object(_ROBOT_STATEMENT_TYPE__QUESTION_, "Can I help you with the following?")
        ],
        ["d002", "d003"]);
    
    add_response_to_chatbot("d002", "rooms_001", "Rooms", 
        [
            create_response_statement_object(_ROBOT_STATEMENT_TYPE__TEXT_, "You can create, edit and add rooms ..."),
            create_response_statement_object(_ROBOT_STATEMENT_TYPE__TEXT_, "For existing rooms you are not a member of, a user has to add you ..."),
            create_response_statement_object(_ROBOT_STATEMENT_TYPE__ANSWER_, "This is an answer")
        ],
        ["d001", "d003"]);
    add_response_to_chatbot("d003", "contacts_001", "Contacts",
        [
            create_response_statement_object(_ROBOT_STATEMENT_TYPE__ANSWER_, "You can search for contacts by clicking the button on the top right and then selecting the 'Find Contacts' menu option"),
            create_response_statement_object(_ROBOT_STATEMENT_TYPE__ANSWER_, "Just enter the user's Nickname and select 'Search'"),
            create_response_statement_object(_ROBOT_STATEMENT_TYPE__ANSWER_, "If any users are found, tou can add the user to your friends list by clicking on the add button"),
            create_response_statement_object(_ROBOT_STATEMENT_TYPE__QUESTION_, "Is there anything else I can help you with?")
        ],
        ["d001", "d002"]);
}

function setup_robot()
{
    _ROBOT_UID_ = "robot_" + user_uid;
    //add robot as a user
    add_user_profile(_ROBOT_UID_, "Mr. Robot", "Mr. Robot", "./images/robot.png", 
                    "Long hours, existing under global robo-oppression", 
                    "www.wolframalpha.com");
}

async function setup_robot_room()
{
    //create a room
    add_non_firebase_room(_ROBOT_ROOM_ID_, "Help", user_uid, 
    __DEFAULT_ROOM_IMAGE_LINK__, [user_uid, _ROBOT_UID_]);
    //add room to menu
    let room = await add_room_to_menu(_ROBOT_ROOM_ID_);
    room.on("click", event => { send_robot_response("d001"); })
    //send a message to the room
    send_robot_response("d001");
}

async function send_robot_response(response_id)
{
    if (!(response_id in _ROBOT_DIALOG_))
        throw new Error(`no such response_id: ${response_id}`);

    let statements = _ROBOT_DIALOG_[response_id][_ROBOT_RESPONSE_STATEMENTS_];
    let options = _ROBOT_DIALOG_[response_id][_ROBOT_RESPONSE_OPTIONS_];
    let i, css_style, text, elem, option_response_id;

    if (statements)
        for (i=0; i &lt; statements.length; i++)
        {
            let type = statements[i][_ROBOT_STATEMENT_TYPE_];
            css_style = get_statement_css_classname(type);
            text = statements[i][_ROBOT_STATEMENT_DATA_];
            elem = await add_chatroom_message(_ROBOT_UID_, (new Date()).getTime(), text);
            $(elem).children(".other-user-msg").addClass(css_style);
        }
    
    if (options)
        for (i=0; i &lt; options.length; i++)
        {
            option_response_id = options[i];
            css_style = get_statement_css_classname(_ROBOT_STATEMENT_TYPE__OPTION_);
            text = _ROBOT_DIALOG_[option_response_id][_ROBOT_RESPONSE_DESCRIPTION_];
            elem = await add_chatroom_message(_ROBOT_UID_, (new Date()).getTime(), text);
            elem.children(".other-user-msg")
                .addClass(css_style)
                .attr("data-option-response-id", option_response_id)
                .on("click", event => {
                    hide_robochat_messages();
                    //send this user message
                    let curr_obj = $(event.currentTarget);
                    // $(`#chatlog`).empty();
                    add_chatroom_message(user_uid, (new Date()).getTime(), `Tell me about: "${curr_obj.html()}"`);
                    send_robot_response( curr_obj.attr("data-option-response-id") );
                });
        }
}

function hide_robochat_messages()
{
    let prev_messages = $(`#chatlog`).children();
    for (let i=0; i &lt; prev_messages.length; i++)
    {
        let child_elem = $(prev_messages[i]);
        let child_height = child_elem.height();
        console.log(child_height + "px");
        child_elem.css(`opacity`, `0`)
                  .one('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd', function(event) {
                            console.log("zero alpha");
                            $(event.currentTarget).css(`height`, `0px`);
                        });
    }
}

function get_statement_css_classname(type)
{
    let css_class;
    switch (type)
    {
        case _ROBOT_STATEMENT_TYPE__ANSWER_ :   //italic
            css_class = "robot-answer";                     
            break;
        case _ROBOT_STATEMENT_TYPE__QUESTION_ : //bold
            css_class = "robot-question";                     
            break;
        case _ROBOT_STATEMENT_TYPE__OPTION_ :   //hover effect on text
            css_class = "robot-option";                     
            break;
        case _ROBOT_STATEMENT_TYPE__TEXT_ :     //normal
        default :                               //normal
            css_class = "robot-default";
            break;
    }
    return css_class;
}

//responsible for building the chat robot 

function add_response_to_chatbot(response_id, debug_id, description, statements, options)
{
    console.log(response_id, debug_id, description, statements.length, options.length);
    let proceed = false;
    if (response_id &amp;&amp; description &amp;&amp; statements &amp;&amp; options)
        if ( (response_id instanceof String || typeof response_id === "string") &amp;&amp; (description instanceof String || typeof description === "string") )
            if ( Array.isArray(statements) &amp;&amp; Array.isArray(options) )
                proceed = true;
    if (!proceed)
    {
        console.log(response_id instanceof String, typeof response_id === "string", typeof response_id);
        console.log(description instanceof String, typeof description === "string", typeof description);
        let str = `response_id : ${response_id}, debug_id : ${debug_id}, description : ${description}, statements : ${statements}, options : ${options}.`;
        let err = new Error(`"ROBOT response error with the following args"\n${str}`);
        throw err;
    }
    let obj = {};
    obj[_ROBOT_RESPONSE_ID_] = debug_id; //not really needed, but good for debugging, give this an id/name that is descriptive for debugging/navigational purposes
    obj[_ROBOT_RESPONSE_DESCRIPTION_] = description;
    obj[_ROBOT_RESPONSE_STATEMENTS_] = statements;
    obj[_ROBOT_RESPONSE_OPTIONS_] = options;

    if (!(_ROBOT_DIALOG_))
        _ROBOT_DIALOG_ = {};
    
    _ROBOT_DIALOG_[response_id] = obj;
}

/**
 * Creates a response object and adds it to the provided array argument
 * @param {*} type The type of response object
 * @param {*} data The data to be shown to the user
 * @returns An object formatted for the chatbot
 */
function create_response_statement_object(type, data)
{
    if (_STATEMENT_TYPES_.includes(type))
    {
        if ((typeof data === 'string' || data instanceof String) &amp;&amp; data != "")
        {
            let obj = {};
            obj[_ROBOT_STATEMENT_TYPE_] = type;
            obj[_ROBOT_STATEMENT_DATA_] = data;
            return obj;
        }
        else
        {
            console.log(typeof data === 'string', data instanceof String);
            console.log(data != "");
            throw new Error(`create_response_statement_object(${type}, '${data}') 2nd arg 'data' needs to be an non empty string, '${data}' given`);
        }
    }
    else
        throw new Error(`create_response_statement_object('${type}', '${data}'), 1st argument was not of type: + ${_STATEMENT_TYPES_.toString()}`);
}



// basic structure

// each response has a statement array, which can have text, questions or answers.
// each response has an option array, which links to other responses

// r
//     s
//     o -> r

//  -> o
// o -> 

// q -> o   1...n
// o -> q|a 1...n
// a -> text

// JSON [id]
//     id 1                    int
//     description 1           string &lt;-- used for short descriptions
//     statement {
//         type                text|question|answer    &lt;-- used for styling or adding links
//         data                string
//     }
//     options {
//         i : id 0..n
//     } </code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#__DEFAULT_PROFILE_IMAGE_LINK__">__DEFAULT_PROFILE_IMAGE_LINK__</a></li><li><a href="global.html#__DEFAULT_ROOM_IMAGE_LINK__">__DEFAULT_ROOM_IMAGE_LINK__</a></li><li><a href="global.html#__USE_24_HOUR_CLOCK__">__USE_24_HOUR_CLOCK__</a></li><li><a href="global.html#__USER_INFO_BIO__">__USER_INFO_BIO__</a></li><li><a href="global.html#__USER_INFO_HOME__">__USER_INFO_HOME__</a></li><li><a href="global.html#__USER_INFO_NAME__">__USER_INFO_NAME__</a></li><li><a href="global.html#__USER_INFO_NICK__">__USER_INFO_NICK__</a></li><li><a href="global.html#__USER_INFO_PIC__">__USER_INFO_PIC__</a></li><li><a href="global.html#__USER_PROFILE_COLOR__">__USER_PROFILE_COLOR__</a></li><li><a href="global.html#__USER_PROFILE_CSS__">__USER_PROFILE_CSS__</a></li><li><a href="global.html#add_chatroom_message">add_chatroom_message</a></li><li><a href="global.html#add_non_firebase_room">add_non_firebase_room</a></li><li><a href="global.html#add_room">add_room</a></li><li><a href="global.html#add_room_to_menu">add_room_to_menu</a></li><li><a href="global.html#add_user_profile">add_user_profile</a></li><li><a href="global.html#attach_received_user_profile_listener">attach_received_user_profile_listener</a></li><li><a href="global.html#auth">auth</a></li><li><a href="global.html#change_user_data_in_gui">change_user_data_in_gui</a></li><li><a href="global.html#choose_user_font_color">choose_user_font_color</a></li><li><a href="global.html#clear_message_text">clear_message_text</a></li><li><a href="global.html#connect_to_firebase">connect_to_firebase</a></li><li><a href="global.html#continue_to_add_chatroom_message">continue_to_add_chatroom_message</a></li><li><a href="global.html#create_next_user_color">create_next_user_color</a></li><li><a href="global.html#create_response_statement_object">create_response_statement_object</a></li><li><a href="global.html#create_user_style">create_user_style</a></li><li><a href="global.html#database">database</a></li><li><a href="global.html#discerning_allow_empty">discerning_allow_empty</a></li><li><a href="global.html#empty_user_variables">empty_user_variables</a></li><li><a href="global.html#fetch_user_contacts">fetch_user_contacts</a></li><li><a href="global.html#firebase_add_contact">firebase_add_contact</a></li><li><a href="global.html#firebase_add_user_to_chatroom_event">firebase_add_user_to_chatroom_event</a></li><li><a href="global.html#firebase_create_chatroom">firebase_create_chatroom</a></li><li><a href="global.html#firebase_edit_chatroom">firebase_edit_chatroom</a></li><li><a href="global.html#firebase_remove_contact">firebase_remove_contact</a></li><li><a href="global.html#flash_room_on_menu">flash_room_on_menu</a></li><li><a href="global.html#human_readable_timestamp">human_readable_timestamp</a></li><li><a href="global.html#init_chat_section">init_chat_section</a></li><li><a href="global.html#init_modal_button_functions">init_modal_button_functions</a></li><li><a href="global.html#init_user">init_user</a></li><li><a href="global.html#initialize_app">initialize_app</a></li><li><a href="global.html#load_user_profile">load_user_profile</a></li><li><a href="global.html#message_received">message_received</a></li><li><a href="global.html#navigation_setup">navigation_setup</a></li><li><a href="global.html#populate_object_field">populate_object_field</a></li><li><a href="global.html#populate_profile_parameters">populate_profile_parameters</a></li><li><a href="global.html#populate_user_data">populate_user_data</a></li><li><a href="global.html#preview_image">preview_image</a></li><li><a href="global.html#print_user_contacts">print_user_contacts</a></li><li><a href="global.html#queued_view_profile_user_id">queued_view_profile_user_id</a></li><li><a href="global.html#received_user_contacts_list">received_user_contacts_list</a></li><li><a href="global.html#received_user_profile">received_user_profile</a></li><li><a href="global.html#remove_allow_empty_children">remove_allow_empty_children</a></li><li><a href="global.html#remove_modal_body_content">remove_modal_body_content</a></li><li><a href="global.html#reset_gui">reset_gui</a></li><li><a href="global.html#resize_menu_button">resize_menu_button</a></li><li><a href="global.html#retrieve_user_info">retrieve_user_info</a></li><li><a href="global.html#room_selected">room_selected</a></li><li><a href="global.html#scroll_to_last_row">scroll_to_last_row</a></li><li><a href="global.html#send_message_event">send_message_event</a></li><li><a href="global.html#setup_navigation_listeners">setup_navigation_listeners</a></li><li><a href="global.html#show_queued_modal">show_queued_modal</a></li><li><a href="global.html#update_current_user_info">update_current_user_info</a></li><li><a href="global.html#update_user_data_in_gui">update_user_data_in_gui</a></li><li><a href="global.html#user_contacts">user_contacts</a></li><li><a href="global.html#user_info">user_info</a></li><li><a href="global.html#user_profiles">user_profiles</a></li><li><a href="global.html#user_rooms">user_rooms</a></li><li><a href="global.html#user_tokens">user_tokens</a></li><li><a href="global.html#user_uid">user_uid</a></li><li><a href="global.html#vars_remove_contact">vars_remove_contact</a></li><li><a href="global.html#view_room_info_modal_prep">view_room_info_modal_prep</a></li><li><a href="global.html#view_user_profile_modal_prep">view_user_profile_modal_prep</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Wed Oct 20 2021 18:29:45 GMT+0100 (British Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
