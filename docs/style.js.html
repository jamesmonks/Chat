<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: style.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: style.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Function creates a style to be applied to the chat log. This function
 * should only be called by add_user_profile. It should only be called after
 * the user_id is added to the user_profiles object.
 * @param {string} user_id The id of the user
 */
function create_user_style(user_id)
{
    let user_obj = user_profiles[user_id];
    let user_font_color = choose_user_font_color(user_obj[__USER_PROFILE_COLOR__]);
    let dyn_sht = document.getElementById("dynamic-style").sheet;

    dyn_sht.insertRule( `div.all-messages.${user_obj[__USER_PROFILE_CSS__]} {` +
                        `background-color : #${user_obj[__USER_PROFILE_COLOR__]};` +
                        `color : ${user_font_color}; } `);
    dyn_sht.insertRule( `div.speech-bg.${user_obj[__USER_PROFILE_CSS__]} {` +
                        `background-color : #${user_obj[__USER_PROFILE_COLOR__]}; } `);
    dyn_sht.insertRule( `.other-user-msg.${user_obj[__USER_PROFILE_CSS__]}:after {
                        content: "";
                        width: 0px;
                        height: 0px;
                        position: absolute;
                        border-left: 10px solid #${user_obj[__USER_PROFILE_COLOR__]};
                        border-right: 10px solid transparent;
                        border-top: 10px solid #${user_obj[__USER_PROFILE_COLOR__]};
                        border-bottom: 10px solid transparent;
                        right: -10px;
                        top: 0px;
    }`);
}

/**
 * @description This function chooses the font color of the text that will be displayed with the arguments
 * choice of background colour
 * @param {string} hex_color 6 character string with the hex values of the colour in rgb format
 * @returns A 6 character string with the hex values of the font colour in rgb format
 */
function choose_user_font_color(hex_color)
{
    if (hex_color.length != 6)
        throw new Error(`choose_user_font_color(${hex_color}) given a non 6 character string`)
    let r_value = parseInt(hex_color.substring(0,2), 16);
    let g_value = parseInt(hex_color.substring(2,4), 16);
    let b_value = parseInt(hex_color.substring(4,6), 16);

    return (r_value &lt; 128 || g_value &lt; 128 || b_value &lt; 128) ? "#EEEEEE" 
                                                             : "#222222";
}
 
/**
 * @type {function}
 * @description Function creates the next color to be used for the background of a new user.
 * It is defined by the length of the user_profiles array, so if no new user is added
 * to the user_profiles array, the same color is returned.
 * @returns {string} 6 character string of the background color in base16
 */
function create_next_user_color()
{
    let jump = 48;
    let len  = Object.keys(user_profiles).length;    //get length of user_colors
    let mod  = len % 7;                              //get the value of modulus 7 (increment r, g, b)
    let div  = Math.floor(len/7);
    let base = jump * (1 + div);
    base %= (256 - jump);  //we don't want this value to be less than a jump's distance to 255 as rgb values could dip below 0

    //if value is 0 define new base; 1 -r; 2 -g; 3 -b; 4 -rg; 5 -rb; 6 -gb;
    let r = g = b = base;
    console.log({length : len, modulus : mod, divide_by_7 : div});
    switch (mod){
        case 0 : break;
        case 1 : r += jump; break;
        case 2 : g += jump; break;
        case 3 : b += jump; break;
        case 4 : r += jump; g += jump; break;
        case 5 : r += jump; b += jump; break;
        case 6 : g += jump; b += jump; break;
    }
    r = 256 - r;
    g = 256 - g;
    b = 256 - b;
    let col = r.toString(16) + g.toString(16) + b.toString(16);
    console.log({red : r, green : g, blue : b, hex : col});
    return col;
}

/**
 * @type {function}
 * @description Function makes a request (if needed) for a user's information from firebase
 * @param {*} user_key The user id of the user
 * @returns nothing
 */
async function retrieve_user_info(user_key)
{
    //test if contact already has a profile
    if (user_key in user_contacts)
        return;
    
    user_contacts[user_key] = true; //used only in the view profile screen
    //assign if not. I think this is quite large, there may be an ill-defined object's role in user_contacts or elsewhere
    let ref_path = `/users/${user_key}/info`;
    let ref = database.ref(ref_path);
    await ref.once("value", received_user_profile);
}

/**
 * @type {function}
 * @description Function removes the user defined by the user_key from the currently logged in user_contacts
 * list
 * @param {string} user_key The value of the user's id to be removed from the contact's list
 */
function vars_remove_contact(user_key)
{
    console.log(`vars_remove_contact(${user_key}, ${callback_fx})`);
    print_user_contacts();
    let new_contacts = {};
    jQuery.each(user_contacts, function(oldkey, oldvalue) {
        console.log(`anonymous key function (${oldkey, oldvalue})`);
        console.log(oldkey, oldkey !== user_key, oldkey != user_key);
        if (oldkey !== user_key)
            new_contacts[oldkey] = oldvalue;
    });
    user_contacts = new_contacts;
    print_user_contacts();
    console.log(`new_contacts:${new_contacts}`);
}

/**
 * @type {function}
 * @description Helper function that displays the user_contacts object into the console.
 */
function print_user_contacts()
{
    let str = `user_contacts status: `;
    str += ` instanceof object: ${user_contacts instanceof Object}`;
    str += ` length: ${Object.keys(user_contacts).length}`;
    str += ` keys: ${Object.keys(user_contacts).toString()}`;
    console.log(str);   
}

/**
 * @type {function}
 * @description Clears the site's chatrooms, room messages and any logged in user specific visual elements.
 * @param {event} event Optional triggering event
 */
function reset_gui(event = null)
{
    //TODO
    $("#chat-input-row").hide(400);
    $("#show-create-room-modal-button").hide(400);
    remove_allow_empty_children("#chat-app");
    navigation_setup(false);
}

/**
 * @type {function}
 * @description This function displays the appropriate menu and display items for a logged in or logged out user
 * @param {boolean} logged_in Variable stating if there is a user logged in or not
 */
function navigation_setup(logged_in)
{
    if (logged_in)
    {
        $(`.users-chatrooms-selector`).removeClass(`d-none`).addClass(`d-block`);
        $(`.chat-show-users`).addClass("d-none");
        $(`.chat-show-chatrooms`).one("click", event => { $(`.chat-show-users`).removeClass("d-none"); })
        $(`#sign-in-method-button`).addClass(`d-none`);
        $(`.navbar-toggler`).removeClass(`d-none`).addClass(`d-inline-block`);
        $(`#nav-logged-in`).show(1000);
        $(`#nav-logged-out`).hide();
    }
    else
    {
        $(`.users-chatrooms-selector`).addClass(`d-none`).removeClass(`d-block`);
        $(`#sign-in-method-button`).removeClass(`d-none`);
        $(`.navbar-toggler`).addClass(`d-none`).removeClass(`d-inline-block`);
        $(`#nav-logged-in`).hide();
        $(`#nav-logged-out`).show(1000);
    }
}

/**
 * @type {function}
 * @description Function alters the size of the buttons for switching between viewing the chatrooms and
 * viewing the users in a chatroom. The buttons are located in the side navigation of the
 * actual chat app.
 */
function resize_menu_button()
{
    let div_width = $("#chatroom-nav").width();
    console.log("ratio setting")
    let ratio = Math.max(1.25, 1.125);
    $(".users-chatrooms-selector .fa").css( "font-size", div_width * (0.5 * 0.6) / ratio );
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#__DEFAULT_PROFILE_IMAGE_LINK__">__DEFAULT_PROFILE_IMAGE_LINK__</a></li><li><a href="global.html#__DEFAULT_ROOM_IMAGE_LINK__">__DEFAULT_ROOM_IMAGE_LINK__</a></li><li><a href="global.html#__USE_24_HOUR_CLOCK__">__USE_24_HOUR_CLOCK__</a></li><li><a href="global.html#__USER_INFO_BIO__">__USER_INFO_BIO__</a></li><li><a href="global.html#__USER_INFO_HOME__">__USER_INFO_HOME__</a></li><li><a href="global.html#__USER_INFO_NAME__">__USER_INFO_NAME__</a></li><li><a href="global.html#__USER_INFO_NICK__">__USER_INFO_NICK__</a></li><li><a href="global.html#__USER_INFO_PIC__">__USER_INFO_PIC__</a></li><li><a href="global.html#__USER_PROFILE_COLOR__">__USER_PROFILE_COLOR__</a></li><li><a href="global.html#__USER_PROFILE_CSS__">__USER_PROFILE_CSS__</a></li><li><a href="global.html#add_chatroom_message">add_chatroom_message</a></li><li><a href="global.html#add_non_firebase_room">add_non_firebase_room</a></li><li><a href="global.html#add_room">add_room</a></li><li><a href="global.html#add_room_to_menu">add_room_to_menu</a></li><li><a href="global.html#add_user_profile">add_user_profile</a></li><li><a href="global.html#attach_received_user_profile_listener">attach_received_user_profile_listener</a></li><li><a href="global.html#auth">auth</a></li><li><a href="global.html#change_user_data_in_gui">change_user_data_in_gui</a></li><li><a href="global.html#choose_user_font_color">choose_user_font_color</a></li><li><a href="global.html#clear_message_text">clear_message_text</a></li><li><a href="global.html#connect_to_firebase">connect_to_firebase</a></li><li><a href="global.html#continue_to_add_chatroom_message">continue_to_add_chatroom_message</a></li><li><a href="global.html#create_next_user_color">create_next_user_color</a></li><li><a href="global.html#create_response_statement_object">create_response_statement_object</a></li><li><a href="global.html#create_user_style">create_user_style</a></li><li><a href="global.html#database">database</a></li><li><a href="global.html#discerning_allow_empty">discerning_allow_empty</a></li><li><a href="global.html#empty_user_variables">empty_user_variables</a></li><li><a href="global.html#fetch_user_contacts">fetch_user_contacts</a></li><li><a href="global.html#firebase_add_contact">firebase_add_contact</a></li><li><a href="global.html#firebase_add_user_to_chatroom_event">firebase_add_user_to_chatroom_event</a></li><li><a href="global.html#firebase_create_chatroom">firebase_create_chatroom</a></li><li><a href="global.html#firebase_edit_chatroom">firebase_edit_chatroom</a></li><li><a href="global.html#firebase_remove_contact">firebase_remove_contact</a></li><li><a href="global.html#flash_room_on_menu">flash_room_on_menu</a></li><li><a href="global.html#human_readable_timestamp">human_readable_timestamp</a></li><li><a href="global.html#init_chat_section">init_chat_section</a></li><li><a href="global.html#init_modal_button_functions">init_modal_button_functions</a></li><li><a href="global.html#init_user">init_user</a></li><li><a href="global.html#initialize_app">initialize_app</a></li><li><a href="global.html#load_user_profile">load_user_profile</a></li><li><a href="global.html#message_received">message_received</a></li><li><a href="global.html#navigation_setup">navigation_setup</a></li><li><a href="global.html#populate_object_field">populate_object_field</a></li><li><a href="global.html#populate_profile_parameters">populate_profile_parameters</a></li><li><a href="global.html#populate_user_data">populate_user_data</a></li><li><a href="global.html#preview_image">preview_image</a></li><li><a href="global.html#print_user_contacts">print_user_contacts</a></li><li><a href="global.html#queued_view_profile_user_id">queued_view_profile_user_id</a></li><li><a href="global.html#received_user_contacts_list">received_user_contacts_list</a></li><li><a href="global.html#received_user_profile">received_user_profile</a></li><li><a href="global.html#remove_allow_empty_children">remove_allow_empty_children</a></li><li><a href="global.html#remove_modal_body_content">remove_modal_body_content</a></li><li><a href="global.html#reset_gui">reset_gui</a></li><li><a href="global.html#resize_menu_button">resize_menu_button</a></li><li><a href="global.html#retrieve_user_info">retrieve_user_info</a></li><li><a href="global.html#room_selected">room_selected</a></li><li><a href="global.html#scroll_to_last_row">scroll_to_last_row</a></li><li><a href="global.html#send_message_event">send_message_event</a></li><li><a href="global.html#setup_navigation_listeners">setup_navigation_listeners</a></li><li><a href="global.html#show_queued_modal">show_queued_modal</a></li><li><a href="global.html#update_current_user_info">update_current_user_info</a></li><li><a href="global.html#update_user_data_in_gui">update_user_data_in_gui</a></li><li><a href="global.html#user_contacts">user_contacts</a></li><li><a href="global.html#user_info">user_info</a></li><li><a href="global.html#user_profiles">user_profiles</a></li><li><a href="global.html#user_rooms">user_rooms</a></li><li><a href="global.html#user_tokens">user_tokens</a></li><li><a href="global.html#user_uid">user_uid</a></li><li><a href="global.html#vars_remove_contact">vars_remove_contact</a></li><li><a href="global.html#view_room_info_modal_prep">view_room_info_modal_prep</a></li><li><a href="global.html#view_user_profile_modal_prep">view_user_profile_modal_prep</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Wed Oct 20 2021 18:29:45 GMT+0100 (British Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
