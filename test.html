<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>

    <!-- Custom CSS here -->
    <link href="./css/index.css" rel="stylesheet" />
    <link href="./css/experiment.css" rel="stylesheet" />
    <link href="./css/side_menu.css" rel="stylesheet" />
    <!-- End custom CSS  -->

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" 
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" 
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>

    <!-- Bootstrap -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" 
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" 
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <!--Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    
    <!-- Placeholder for jQuery/js access -->
    <style id="dynamic-style" type="text/css"></style>

    <!-- Custom js here -->
    <!-- <script type="text/javascript" src="./js/firebase_fx.js"></script>
    <script type="text/javascript" src="./js/style.js"></script>
    <script type="text/javascript" src="./js/login.js"></script>
    <script type="text/javascript" src="./js/modal.js"></script>
    <script type="text/javascript" src="./js/code_playground.js"></script> -->
    <!-- <script type="text/javascript" src="./js/index.js"></script> -->
    <!-- End custom js  -->
</head>
<body class="override">
  <header>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark" id="bulletNav">
      <a class="navbar-brand offset-1" href="#">NoodleChat</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" 
        data-target="#navbarsExample04" aria-controls="navbarsExample04" 
        aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
    
      <div class="collapse navbar-collapse" id="navbarsExample04">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item">
            <a class="nav-link"
              href="https://getbootstrap.com/docs/4.0/getting-started/introduction/"
              target="_blank">Bootstrap docs</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="programminglinks" data-toggle="dropdown" 
              aria-haspopup="true" aria-expanded="false">Reference</a>
            <div class="dropdown-menu" aria-labelledby="programminglinks">
              <a class="dropdown-item" 
                href="https://getbootstrap.com/docs/4.0/getting-started/introduction/"
                target="_blank">Bootstrap docs</a>
              <a class="dropdown-item" 
                href="https://www.freecodecamp.org/news/css-selectors-cheat-sheet/"
                target="_blank">CSS Cheat Sheet</a>
                <a class="dropdown-item" 
                href="https://api.jquery.com/"
                target="_blank">jquery API</a>
              <a class="dropdown-item" 
                href="https://www.rexegg.com/regex-quickstart.html"
                target="_blank">regEx cheatsheet</a>
            </div>
          </li>
        <!-- TODO TOGGLE login-chooser AND logout VISIBILITY, SHOULD NOT BE SEEN TOGETHER
                    AND SHOULD NOT BOTH BE INVISIBLE -->
          <div id="nav-resources">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="programminglinks" data-toggle="dropdown" 
                aria-haspopup="true" aria-expanded="false">Reference</a>
              <div class="dropdown-menu" aria-labelledby="programminglinks">
                <a class="dropdown-item" 
                  href="https://getbootstrap.com/docs/4.0/getting-started/introduction/"
                  target="_blank">Bootstrap ref</a>
                <a class="dropdown-item" 
                  href="https://api.jquery.com/"
                  target="_blank">Jquery ref</a>
                  <a class="dropdown-item" 
                  href="https://firebase.google.com/docs/reference/js"
                  target="_blank">Firebase ref</a>
                <a class="dropdown-item" 
                  href="https://console.firebase.google.com/project/noodlemessager/database/noodlemessager-default-rtdb/data"
                  target="_blank">Firebase data</a>
                <a class="dropdown-item" 
                  href="https://www.freecodecamp.org/news/css-selectors-cheat-sheet/"
                  target="_blank">CSS selectors</a>
                <a class="dropdown-item" 
                  href="https://www.rexegg.com/regex-quickstart.html"
                  target="_blank">regEx ref</a>
              </div>
            </li>
          </div>

          <div id="nav-logged-out">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="nav-anonymous-links" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">Login</a>
              <div class="dropdown-menu" aria-labelledby="nav-anonymous-links">
                <a id="nav-email-login" class="dropdown-item" href="#">E-mail login</a>
                <a id="nav-facebook-login" class="dropdown-item" href="#">Facebook login</a>
                <a id="nav-github-login" class="dropdown-item" href="#">GitHub login</a>
              </div>
            </li>
          </div>
          
          <div id="nav-logged-in">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="nav-user-links" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">User area</a>
              <div class="dropdown-menu" aria-labelledby="nav-user-links">
                <a id="nav-view-profile" class="dropdown-item" href="#">View Profile</a>
                <a id="nav-find-contacts" class="dropdown-item" href="#">Find Contacts</a>
                <button id="nav-signout" class="btn btn-warning" type="button">Signout</button>
              </div>
            </li>
          </div>

          <!-- TODO test for cookie and hide if necessary -->
          <li id="nav-returning-user" class="nav-item">
            <!-- TODO use cookies to store last login and resume chat -->
            <a id="nav-last-login" class="nav-link" href="#">Login</a>
          </li>        
        </ul>
      </div>
    </nav>
  </header>

<!-- TODO This nav element will allow a user to click on a chatroom that they are allowed to be in, on clicking
          of a list element, the ul is repopulated to show users in that chatroom -->
  <main id="chat-app" class="container">
    <div class="">
    <div id="chat-app-row" class="row">

      <!---------------------------------->
      <!------- SIDE NAVIGATION ---------->
      <!---------------------------------->
      <!-- AIMS FOR THE SIDE NAVIGATION
      1) At a certain responsive size, the room name becomes an icon, with a description that expands on mouseover for PC-->
      <nav id="chatroom-nav" class="col-2">
        <button id="show-create-room-modal-button" class="create-button btn btn-primary">New Room</button>
        <ul class="nav flex-column" id="chatroom-nav-list">
          <li id="nav_lg_room1id" class="nav-item text-truncate" value="room1id">This is room 1</li>
          <li id="nav_lg_room2id" class="nav-item text-truncate" value="room2id">This is room 2</li>
          <li id="nav_lg_room3id" class="nav-item text-truncate" value="room3id">This is room 3</li>
        </ul>
      </nav>

      <!---------------------------------->
      <!----------- CHATROOM ------------->
      <!---------------------------------->
      <div id="chatroom" class="col-10">
        <div id="chatlog" class="container">
          <div class="row">
            <div id="uid_timestamp" class="user-uid all-messages other-user-msg col-8 offset-2">
              chat from user 1. Lorem ipsum dolor sit amet consectetur adipisicing elit. Aliquam 
              sint, quisquam porro debitis qui similique velit, reiciendis ipsum 
              voluptas nobis tempora ut veniam saepe dolorem praesentium minus eos? 
              Fugit, aliquid?
            </div>

            <div class="col-2 speech-bg">
              <div class="other-user-speech h-100 w-100"></div>
            </div>
          </div>

          <div class="row">
            <div id="uid_timestamp" class="user-uid all-messages other-user-msg col-8 offset-2">
              chat from user 2
            </div>
            <div class="col-2 speech-bg">
              <div class="other-user-speech h-100 w-100"></div>
            </div>
          </div>

          <div class="row">
            <div id="uid_timestamp" 
            class="user-this all-messages this-user-message col-8">
            chat from me
            </div>
          </div>

        </div>
      </div>
    </div>
    </div>
  </main>

  <div id="this-user-message">
    <div id="user-message-form" class="container">
      <div class="row">
        <input id="user-message-text" type="text" class="form-control col-9" placeholder="Enter Message?">
        <button id="send-user-message" class="form-control btn btn-primary col-3">Send</button>
      </div>
    </div>
  </div>
  <!----------------------------------->
  <!----------- CREATE ROOM ----------->
  <!----------------------------------->
  <div class="modal" id="room-create-modal" tabindex="-1" role="dialog" aria-labelledby="room-create-title" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="room-create-title">Please fill in room info</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="room-create-name">Room name</label>
              <input type="email" class="form-control" id="room-create-name" aria-describedby="room-create-name-help" 
                placeholder="Enter room name" />
              <small id="room-create-name-help" class="form-text text-muted-amended">Please type in your chatroom's name.</small>
            </div>
            <div class="form-group">
              <label for="room-create-logo">Logo</label>
              <input type="text" class="form-control" id="room-create-logo" aria-describedby="room-create-logo-help" placeholder="Enter URL" />
              <small id="room-create-logo-help" class="form-text text-muted-amended">Enter the web link for the room's logo</small>
            </div>
            <input id="room-create-button" type="button" class="btn btn-primary" value="Create" />
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!----------------------------------->
  <!---------- SEARCH USERS ----------->
  <!----------------------------------->

  <div class="modal" id="search-users-modal" tabindex="-1" role="dialog" 
       aria-labelledby="search-users-title" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="search-users-title">Search for Users</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

            <div id="search-users" class="container-fluid">

                <div id="search-users-box" class="row allow-empty align-items-center">
                  <div class="col-12 p-0 my-auto">
                    <div id="search-users-box-logo" class="mt-2 mx-4">
                      <label class="mb-1" for="search-users-box-nick">User Nickname:</label>
                      <div class="input-group">
                        <input id="search-users-box-nick" type="text" class="form-control text-primary list-group-item-primary" placeholder="Enter user nickname"/>
                        <div class="input-group-append">
                          <button id="room-logo-preview-btn" class="btn btn-outline-primary" 
                            data-source="#search-users-box-nick" 
                            data-target="#room-profile-logo-img">Preview</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div> 
                <hr>
                
                <div class="row">
                  <div class="container-fluid">
                    <div id="search-users-results" class="row align-items-end allow-empty">
                        <h3 class="col-12 text-center mb-3"><b>Search Results</b></h3>
                        <div id="user-profile-XXXXXXX" class="col-6 col-sm-4 col-md-3 col-lg-2 text-center user-small-profile">
                          <img src="https://prabook.com/web/show-photo.jpg?id=4557&cache=false" class="browse-profile-pic w-75">
                          <div class="browse-profile-name text-truncate">name</div>
                          <button class="btn btn-primary">Add</button>
                        </div>

                        <div id="user-profile-XXXXXXX" class="col-6 col-sm-4 col-md-3 col-lg-2 text-center user-small-profile">
                          <img src="./images/unknown_profile.jpg" class="browse-profile-pic w-75">
                          <div class="browse-profile-name text-truncate">name</div>
                          <button class="btn btn-primary">Add</button>
                          <button class="btn btn-danger">Remove</button>
                        </div>

                    </div>
                  </div>
                </div>

            </div>

        </div>
        <div class="modal-footer m-0" style="background-color: lightblue;">
          <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!--------------------------------->
  <!----- VIEW ROOM INFORMATION ----->
  <!--------------------------------->

  <div class="modal" id="view-room-profile-modal" tabindex="-1" role="dialog" 
       aria-labelledby="view-room-title" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="view-room-title">UNFILLED ROOMNAME</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

            <div id="room-profile" class="container-fluid">

                <div id="room-profile-view" class="row align-items-end allow-empty">
                    <div class="col-12 col-sm-6 text-center">
                        <div id="room-profile-logo">
                            <img src="./images/unknown_profile.jpg" class="room-profile-logo-img w-50">
                        </div>
                    </div>
                    <div class="col-12 col-sm-6 p-0 my-auto">
                        <div id="room-profile-view-name" class="text-center">
                            <h4 class="text-uppercase">room name</h4>
                        </div>
                        <div class="room-profile-creator-nick text-center">
                            <h4>creator nick</h4>
                        </div>
                    </div>
                </div>
                <div id="room-profile-set" class="row allow-empty align-items-center">
                  <div class="col-12 col-sm-6 text-center">
                      <div id="room-profile-logo">
                          <img id="room-profile-logo-img" src="./images/unknown_profile.jpg" class="room-profile-logo-img w-75">
                      </div>
                  </div>
                  <div class="col-12 col-sm-6 p-0 my-auto">
                    <div id="room-profile-set-name" class="text-left w-100">
                      <label class="mb-1" for="room-profile-set-name-tf">Room Name:</label>
                      <input id="room-profile-set-name-tf" type="text" class="form-control" placeholder="Enter Room Name"/>
                    </div>
                    <div id="room-profile-set-logo" class="text-left mt-2">
                      <label class="mb-1" for="room-profile-set-logo-link">Image source:</label>
                      <div class="input-group w-100">
                        <input id="room-profile-set-logo-link" type="text" class="form-control text-primary list-group-item-primary" placeholder="Enter URL"/>
                        <div class="input-group-append">
                          <button id="room-logo-preview-btn" class="btn btn-outline-primary" 
                            data-source="#room-profile-set-logo-link" 
                            data-target="#room-profile-logo-img">Preview</button>
                        </div>
                      </div>
                    </div>
                    <div id="room-profile-update" class="text-center mt-3 mt-sm-2 mt-lg-4">
                      <button id="room-profile-update-btn" class="btn-primary btn form-group text">Submit</button>
                    </div>
                  </div>
                </div> 
                <hr>
                
                <div class="row">
                  <div class="container-fluid">
                    <div id="room-profile-contacts" class="row align-items-end allow-empty">
                        <h4 class="col-12 text-center">MEMBERS</h4>
                        <div id="user-profile-XXXXXXX" class="col-6 col-sm-4 col-md-3 col-lg-2 text-center user-small-profile">
                          <img src="https://prabook.com/web/show-photo.jpg?id=4557&cache=false" class="browse-profile-pic w-75">
                          <div class="browse-profile-name text-truncate">name</div>
                          <button class="btn btn-primary">Add</button>
                        </div>

                        <div id="user-profile-XXXXXXX" class="col-6 col-sm-4 col-md-3 col-lg-2 text-center user-small-profile">
                          <img src="./images/unknown_profile.jpg" class="browse-profile-pic w-75">
                          <div class="browse-profile-name text-truncate">name</div>
                          <button class="btn btn-primary">Add</button>
                          <button class="btn btn-danger">Remove</button>
                        </div>

                        <div id="user-profile-XXXXXXX" class="col-6 col-sm-4 col-md-3 col-lg-2 text-center user-small-profile">
                          <img src="./images/unknown_profile.jpg" class="browse-profile-pic w-75">
                          <div class="browse-profile-name text-truncate">name</div>
                          <button class="btn btn-primary">Add</button>
                          <button class="btn btn-danger">Remove</button>
                        </div>

                        <div id="user-profile-XXXXXXX" class="col-6 col-sm-4 col-md-3 col-lg-2 text-center user-small-profile">
                          <img src="./images/unknown_profile.jpg" class="browse-profile-pic w-75">
                          <div class="browse-profile-name text-truncate">name</div>
                          <button class="btn btn-primary">Add</button>
                          <button class="btn btn-danger">Remove</button>
                        </div>

                        <div id="user-profile-XXXXXXX" class="col-6 col-sm-4 col-md-3 col-lg-2 text-center user-small-profile">
                          <img src="./images/unknown_profile.jpg" class="browse-profile-pic w-75">
                          <div class="browse-profile-name text-truncate">name</div>
                          <button class="btn btn-primary">Add</button>
                          <button class="btn btn-danger">Remove</button>
                        </div>

                        <div id="user-profile-XXXXXXX" class="col-6 col-sm-4 col-md-3 col-lg-2 text-center user-small-profile">
                          <img src="./images/unknown_profile.jpg" class="browse-profile-pic w-75">
                          <div class="browse-profile-name text-truncate">name</div>
                          <button class="btn btn-primary">Add</button>
                          <button class="btn btn-danger">Remove</button>
                        </div>

                        <div id="user-profile-XXXXXXX" class="col-6 col-sm-4 col-md-3 col-lg-2 text-center user-small-profile">
                          <img src="./images/unknown_profile.jpg" class="browse-profile-pic w-75">
                          <div class="browse-profile-name text-truncate">name</div>
                          <button class="btn btn-primary">Add</button><br>
                          <a class="btn btn-danger">testing</a>
                          <!-- introduce a dropdown for user functions, one of which is to add the user to a chatroom -->
                        </div>

                        <div id="user-profile-XXXXXXX" class="col-6 col-sm-4 col-md-3 col-lg-2 text-center user-small-profile">
                          <img src="./images/unknown_profile.jpg" class="browse-profile-pic w-75">
                          <div class="browse-profile-name text-truncate">name</div>
                          <button class="btn btn-primary">Add</button>
                          <button class="btn btn-danger">Remove</button>
                        </div>

                        <div id="user-profile-XXXXXXX" class="col-6 col-sm-4 col-md-3 col-lg-2 text-center user-small-profile">
                          <img src="./images/unknown_profile.jpg" class="browse-profile-pic w-75">
                          <div class="browse-profile-name text-truncate">name</div>
                          <button class="btn btn-primary">Add</button>
                          <button class="btn btn-danger">Remove</button>
                        </div>

                        <div id="user-profile-XXXXXXX" class="col-6 col-sm-4 col-md-3 col-lg-2 text-center user-small-profile">
                          <img src="./images/unknown_profile.jpg" class="browse-profile-pic w-75">
                          <div class="browse-profile-name text-truncate">name</div>
                          <button class="btn btn-primary">Add</button>
                          <button class="btn btn-danger">Remove</button>
                        </div>

                        <div id="user-profile-XXXXXXX" class="col-6 col-sm-4 col-md-3 col-lg-2 text-center user-small-profile">
                          <img src="./images/unknown_profile.jpg" class="browse-profile-pic w-75">
                          <div class="browse-profile-name text-truncate">name</div>
                          <button class="btn btn-primary">Add</button>
                          <button class="btn btn-danger">Remove</button>
                        </div>


                    </div>
                  </div>
                </div>

            </div>

        </div>
        <div class="modal-footer m-0" style="background-color: lightblue;">
          <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-app.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
      https://firebase.google.com/docs/web/setup#available-libraries -->
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.2/firebase-auth.js"></script>

  <script>

    function init(event = null)
    {
      $(`#search-users-modal`).show();

      $(`#room-logo-preview-btn`).on("click", attempt_logo_url_retrieval);
      $("#room-profile-update-btn").on("click", firebase_update_room);
      console.log($(`#room-profile-set-logo-link`).val());

      show_room_info(false);
    }

    function show_room_info(is_admin)
    {
      $(`#room-profile-view`).show();
      $(`#room-profile-set`).show();
      (is_admin)  ? $(`#room-profile-view`).hide()
                  : $(`#room-profile-set`).hide();
    }

    function firebase_update_room(event)
    {
      let room_name = $("#room-profile-set-name-tf").val();
      let room_link = $("#room-profile-set-logo-link").val();

      if (room_name == "")
        room_name = "No name";

      if (room_link == "")
        room_link = "./images/e4tn_twitter_logo.jpg";

      let update_obj = {};
      //populate_object_field();
      update_obj["name"] = room_name;
      update_obj["link"] = room_link;
      update_obj["creator"] = "user_uid";

      console.log(update_obj);

      // database.ref(`/chatrooms/room/${current_room_id}`).update(update_obj);
    }

    function attempt_logo_url_retrieval(event) 
    {
      let e_id = event.currentTarget.id;
      console.log("./images/e4tn_twitter_logo.jpg");
      let e_btn = $(`#${e_id}`)[0];
      let img_target_id = $(e_btn).data("target");
      let img_tf_id = $(e_btn).data("source");
      console.log(img_target_id, img_tf_id, $(e_btn).data());
      let img_tf = $(img_tf_id)[0];
      let img_target = $(img_target_id)[0];
      let img_tf_text = $(img_tf).val();
      console.log(img_target, img_tf, img_tf_text);
      
      console.log(`new_src ${img_tf_text}`);
      console.log($(img_target).attr("src"));
      $(img_target).attr("src", img_tf_text);
    }

    $(document).ready(init);
    console.log($("#room-profile-set-logo-link"));
  </script>

</body>
</html>