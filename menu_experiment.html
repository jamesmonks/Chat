<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="./css/side_menu.css" rel="stylesheet">
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" 
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" 
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>

    <!-- Bootstrap -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" 
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" 
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

</head>
<header class="container">
    <nav class="navbar navbar-expand-md navbar-dark bg-dark" id="bulletNav">
        <a class="navbar-brand offset-1" href="#">NoodleChat</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" 
            data-target="#nav-menu-items" aria-controls="nav-menu-items" 
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
    
       <div class="collapse navbar-collapse navbar-nav justify-content-end pr-5 mr-5" id="nav-menu-items">
        <!-- TODO TOGGLE login-chooser AND logout VISIBILITY, SHOULD NOT BE SEEN TOGETHER
                    AND SHOULD NOT BOTH BE INVISIBLE -->
            <div class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="programminglinks" data-toggle="dropdown" 
                    aria-haspopup="true" aria-expanded="false">Reference</a>
                <div class="dropdown-menu" aria-labelledby="programminglinks">
                    <a class="dropdown-item" 
                    href="https://getbootstrap.com/docs/4.0/getting-started/introduction/"
                    target="_blank">Bootstrap ref</a>
                    <a class="dropdown-item" 
                    href="https://api.jquery.com/"
                    target="_blank">Jquery ref</a>
                    <a class="dropdown-item" 
                    href="https://firebase.google.com/docs/reference/js"
                    target="_blank">Firebase ref</a>
                    <a class="dropdown-item" 
                    href="https://console.firebase.google.com/project/noodlemessager/database/noodlemessager-default-rtdb/data"
                    target="_blank">Firebase data</a>
                    <a class="dropdown-item" 
                    href="https://www.freecodecamp.org/news/css-selectors-cheat-sheet/"
                    target="_blank">CSS selectors</a>
                    <a class="dropdown-item" 
                    href="https://www.rexegg.com/regex-quickstart.html"
                    target="_blank">regEx ref</a>
                </div>
            </div>

            <div id="nav-logged-out">
                <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="nav-anonymous-links" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">Login</a>
                <div class="dropdown-menu" aria-labelledby="nav-anonymous-links">
                    <a id="nav-email-login" class="dropdown-item" href="#">E-mail login</a>
                    <a id="nav-facebook-login" class="dropdown-item" href="#">Facebook login</a>
                    <a id="nav-github-login" class="dropdown-item" href="#">GitHub login</a>
                </div>
                </li>
            </div>
          
            <div id="nav-logged-in">
                <div class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="nav-user-links" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">User area</a>
                <div class="dropdown-menu" aria-labelledby="nav-user-links">
                    <a id="nav-view-profile" class="dropdown-item" href="#">View Profile</a>
                    <a id="nav-find-contacts" class="dropdown-item" href="#">Find Contacts</a>
                    <button id="nav-signout" class="btn btn-warning" type="button">Signout</button>
                </div>
                </div>
            </div>

            <!-- TODO test for cookie and hide if necessary -->
            <div id="nav-returning-user" class="nav-item">
                <!-- TODO use cookies to store last login and resume chat -->
                <a id="nav-last-login" class="nav-link btn btn-outline-secondary" href="#">Login</a>
            </div>        
        
        </div>
    </nav>
</header>
  
  <body>

    
    <div class="container">
        <div class="row">
            <nav id="chatroom-nav" class="chat-side-menu col-2">
                <button id="show-create-room-modal-button" class="create-button btn btn-primary">New Room</button>
                
                <div class="room-button has-unread-messages">
                    <div class="full-chatroom-name">Room W has a really long name</div>
                    <div class="room-initial">w</div>
                    <div class="room-initial second-letter">w</div>
                </div>
                
                <div class="room-button">
                    <div class="full-chatroom-name">Room M</div>
                    <div class="room-initial">M</div>
                    <div class="room-initial second-letter">j</div>
                </div>

                <div class="room-button">
                    <div class="full-chatroom-name">Room W has</div>
                    <img class="room-icon" src="images/2021-02-03.jpg">
                </div>
                
                <div class="room-button">
                    <div class="full-chatroom-name">D</div>
                    <img class="room-icon" src="images/2021-02-03.jpg">
                </div>
            </div>
            <div class="col-9">
                
            </div>
        </div> 
    </div>



    <div class="modal" id="chat-info-modal" tabindex="-1" role="dialog" 
    aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">What is this?</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
                <div class="modal-body">
                This is what it is
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


</body>
<button id="add-button" class="btn btn-primary">add text room</button>
<button id="add-img-button" class="btn btn-primary">add image room</button>
<script>
    $(`#add-button`).on(`click`, add_room);
    $(`#add-img-button`).on(`click`, add_image_room);
    
    function add_room(event)
    {
        let two_words = Math.round( Math.random() );
        (two_words) ? create_room(g_id(), "James Zamir Monks")
                    : create_room(g_id(), "James");
    }

    function g_id() {
        return Math.round(Math.random() * 1000)
    }

    function create_room(room_id, room_name = null, image_url = null)
    {
        let test_button = $(`<div class="room-button" data-toggle="collapse" data-target="#sidemenu-room-summary-${room_id}">`);
        let initials_arr = room_name.split(` `);
        let full_room_name = $(`<div class="full-chatroom-name">`).append(room_name); 
        if (room_name.length > 12)
            test_button.addClass(`full-room-minim`);
        
        test_button.append( full_room_name );
            
        if (image_url)
            test_button.append( $(`<img class="room-icon" src="${image_url}">`) );

        if (image_url == null)
        {

            if (initials_arr.length > 1)
            {
                test_button.append( $(`<div class="room-initial">${initials_arr[0].substr(0, 1)}</div>`) );
                    test_button.append( $(`<div class="room-initial second-letter">${initials_arr[1].substr(0, 1)}</div>`) );
            }

            if (initials_arr.length == 1)
                test_button.append( $(`<div class="room-initial only-letter">${initials_arr[0].substr(0, 1)}</div>`) );
            
        }
        $("#chatroom-nav").append(test_button);
        // test_button.on("click", event => {
        //     $(`#sidemenu-room-summary-${room_id}`);
        // });

        let description_div = create_description_div(room_id, room_id, room_id);
        $("#chatroom-nav").append(description_div);
    }

    function create_description_div(room_id, room_name, room_creator)
    {
        let desc_div = $(
            `<div id="sidemenu-room-summary-${room_id}" class="border-top border-bottom border-primary collapse my-2">
                <label for="${room_id}-sidemenu-summary-name" class="small sidemenu-room-summary-label">Roomname:</label>
                <div id="${room_id}-sidemenu-summary-name" class="sidemenu-room-summary-text text-right">${room_name}</div>
                <label for="${room_id}-sidemenu-summary-creator" class="small sidemenu-room-summary-label">Creator:</label>
                <div id="${room_id}-sidemenu-summary-creator" class="sidemenu-room-summary-text text-right">${room_creator}</div>
            </div>`);
        let room_info_btn_div = $(`<div class="text-center">`);
        let room_info_btn = $(`<a class="btn py-0 my-2 btn-outline-primary">`).append("Info").on("click", TODO_show_room_info);
        desc_div.append( room_info_btn_div.append(room_info_btn) );
        desc_div.on("shown.bs.collapse", event => {
            event.currentTarget.scrollIntoView(false, { behavior: "smooth", block: "end" } );
        });
        return desc_div;
    }

    function TODO_show_room_info(event)
    {
        //TODO
        console.log(TODO_show_room_info);
    }

    function add_image_room(event)
    {
        let img_url = "https://prabook.com/web/show-photo.jpg?id=4557&cache=false"
        let two_words = Math.round( Math.random() );
        (two_words) ? create_room(g_id(), "Freddie Mercury", img_url)
                    : create_room(g_id(), "Freddie", img_url);
    }
</script>
</html>